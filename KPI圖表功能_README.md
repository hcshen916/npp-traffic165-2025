# KPI åœ–è¡¨åŠŸèƒ½ - å¿«é€Ÿé–‹å§‹

## ğŸ¯ åŠŸèƒ½ç¸½è¦½

æœ¬æ¬¡æ›´æ–°è§£æ±ºäº†å…©å€‹ä¸»è¦å•é¡Œï¼Œä¸¦æ–°å¢äº† KPI åœ–è¡¨åŠŸèƒ½ï¼š

âœ… **å•é¡Œä¿®å¾©**
1. å‰å°ç„¡æ³•é¡¯ç¤º CMS å¾Œå°è¨­å®šçš„æ¨™é¡Œ â†’ å·²è¨ºæ–·ä¸¦æä¾›ç·©å­˜æ¸…é™¤æ–¹æ¡ˆ
2. KPI é…ç½®ç„¡æ³•æ›´æ–° â†’ å·²å»ºç«‹å®Œæ•´çš„é…ç½®æµç¨‹

âœ… **æ–°å¢åŠŸèƒ½**
3. KPI å¤šç¨®é¡¯ç¤ºæ¨¡å¼ â†’ æ”¯æ´å¡ç‰‡ã€åœ“é¤…åœ–ã€é•·æ¢åœ–ã€æŠ˜ç·šåœ–ï¼ˆç´” CSS/SVG å¯¦ä½œï¼‰

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### æ–¹æ³• Aï¼šä¸€éµéƒ¨ç½²ï¼ˆæ¨è–¦ï¼‰

```bash
./deploy-kpi-charts.sh
```

é€™å€‹è…³æœ¬æœƒè‡ªå‹•ï¼š
- é‡å•Ÿ CMS æœå‹™ï¼ˆå¥—ç”¨æ–°æ¨¡å‹ï¼‰
- é‡å•Ÿ Frontend æœå‹™ï¼ˆæ¸…é™¤ç·©å­˜ï¼‰
- æª¢æŸ¥æ‰€æœ‰ API ç«¯é»
- é¡¯ç¤ºç•¶å‰ç‹€æ…‹

### æ–¹æ³• Bï¼šæ‰‹å‹•éƒ¨ç½²

```bash
# 1. é‡å•Ÿæœå‹™
docker-compose restart cms
sleep 30
docker-compose restart frontend
sleep 30

# 2. åœ¨ CMS ä¸­å»ºç«‹ KPI é…ç½®
# è¨ªå• http://34.81.244.21:1337/admin
# é€²å…¥ Content Manager > KPI Configuration
# å»ºç«‹è‡³å°‘ä¸€å€‹é…ç½®ï¼ˆåƒè€ƒä¸‹æ–¹ç¯„ä¾‹ï¼‰

# 3. é©—è­‰å‰å°
# è¨ªå• http://34.81.244.21:3000
```

---

## ğŸ“ åœ¨ CMS ä¸­å»ºç«‹ KPI é…ç½®

### ç™»å…¥ CMS

è¨ªå•ï¼šhttp://34.81.244.21:1337/admin

### å»ºç«‹é…ç½®ç¯„ä¾‹

é€²å…¥ **Content Manager** > **KPI Configuration** > **Create New Entry**

#### ç¯„ä¾‹ 1ï¼šç¸½æ­»äº¡äººæ•¸ï¼ˆå¡ç‰‡ï¼‰

| æ¬„ä½ | å€¼ |
|------|------|
| Key | `fatal_total` |
| Label | ç¸½æ­»äº¡äººæ•¸ |
| Icon | ğŸš¨ |
| Unit | äºº |
| Display Order | 1 |
| Is Active | âœ“ |
| Color Scheme | danger |
| Display Type | **card** |

#### ç¯„ä¾‹ 2ï¼šè¡Œäººæ­»äº¡äººæ•¸ï¼ˆåœ“é¤…åœ–ï¼‰

| æ¬„ä½ | å€¼ |
|------|------|
| Key | `fatal_ped` |
| Label | è¡Œäººæ­»äº¡äººæ•¸ |
| Icon | ğŸš¶ |
| Unit | äºº |
| Display Order | 2 |
| Is Active | âœ“ |
| Color Scheme | danger |
| Display Type | **pie** |

#### ç¯„ä¾‹ 3ï¼šå…’å°‘æ­»äº¡äººæ•¸ï¼ˆé•·æ¢åœ–ï¼‰

| æ¬„ä½ | å€¼ |
|------|------|
| Key | `fatal_minor` |
| Label | å…’å°‘æ­»äº¡äººæ•¸ |
| Icon | ğŸ‘¶ |
| Unit | äºº |
| Display Order | 3 |
| Is Active | âœ“ |
| Color Scheme | warning |
| Display Type | **bar** |

**é‡è¦ï¼š** `Key` å¿…é ˆèˆ‡è³‡æ–™åº«ä¸­çš„ metric key ä¸€è‡´ï¼

---

## ğŸ¨ é¡¯ç¤ºé¡å‹èªªæ˜

### 1. Cardï¼ˆå¡ç‰‡ï¼‰
- ç°¡æ½”çš„æ•¸æ“šå±•ç¤º
- é©åˆå¿«é€Ÿç€è¦½
- é¡¯ç¤ºç•¶å‰å€¼ã€è®ŠåŒ–ç™¾åˆ†æ¯”ã€åŸºæº–å€¼

### 2. Pieï¼ˆåœ“é¤…åœ–ï¼‰
- åœ“å½¢åœ–è¡¨
- é©åˆé¡¯ç¤ºç•¶å‰å€¼èˆ‡åŸºæº–å€¼çš„æ¯”ä¾‹
- è¦–è¦ºåŒ–æ•ˆæœä½³

### 3. Barï¼ˆé•·æ¢åœ–ï¼‰
- æ°´å¹³é•·æ¢åœ–
- é©åˆç›´æ¥æ¯”è¼ƒå…©å€‹æ•¸å€¼
- æ¸…æ¥šé¡¯ç¤ºå·®è·

### 4. Lineï¼ˆæŠ˜ç·šåœ–ï¼‰
- è¶¨å‹¢ç·šåœ–
- é©åˆé¡¯ç¤ºæ•¸å€¼è®ŠåŒ–æ–¹å‘
- ç°¡æ½”æ˜ç¢º

---

## ğŸ”§ ç–‘é›£æ’è§£

### å•é¡Œï¼šå‰å°æ¨™é¡Œæ²’æœ‰æ›´æ–°

**è§£æ±ºæ–¹æ³•ï¼š**
```bash
# é‡å•Ÿ Frontend æ¸…é™¤ç·©å­˜
docker-compose restart frontend
```

æˆ–ç­‰å¾… 5 åˆ†é˜è®“ç·©å­˜è‡ªå‹•éæœŸã€‚

### å•é¡Œï¼šKPI é…ç½®åœ¨ CMS ä¸­çœ‹ä¸åˆ° Display Type æ¬„ä½

**è§£æ±ºæ–¹æ³•ï¼š**
```bash
# é‡å•Ÿ CMS è®“æ–°æ¨¡å‹ç”Ÿæ•ˆ
docker-compose restart cms
```

### å•é¡Œï¼šå‰å°é¡¯ç¤ºã€Œå°šç„¡è³‡æ–™ã€

**å¯èƒ½åŸå› ï¼š**
1. å°šæœªåœ¨ CMS ä¸­å»ºç«‹ KPI é…ç½®
2. Key ä¸åŒ¹é…
3. Is Active æœªå‹¾é¸

**è§£æ±ºæ–¹æ³•ï¼š**
1. æª¢æŸ¥ CMS ä¸­æ˜¯å¦æœ‰ KPI é…ç½®
2. ç¢ºèª Key æ˜¯å¦æ­£ç¢ºï¼ˆ`fatal_total`, `fatal_ped`, `fatal_minor`ï¼‰
3. ç¢ºèª Is Active å·²å‹¾é¸
4. æ¸…é™¤å‰å°ç·©å­˜

### å•é¡Œï¼šåœ–è¡¨é¡¯ç¤ºç•°å¸¸

**è§£æ±ºæ–¹æ³•ï¼š**
```bash
# ç€è¦½å™¨å¼·åˆ¶é‡æ–°æ•´ç†
# Windows/Linux: Ctrl + Shift + R
# Mac: Cmd + Shift + R

# å¦‚æœä»ç„¶ç•°å¸¸ï¼Œé‡æ–°æ§‹å»ºå‰å°
docker-compose up -d --build frontend
```

---

## ğŸ“š å®Œæ•´æ–‡ä»¶

- **[å®Œæ•´è§£æ±ºæ–¹æ¡ˆç¸½çµ.md](./å®Œæ•´è§£æ±ºæ–¹æ¡ˆç¸½çµ.md)** - æ‰€æœ‰å•é¡Œçš„è©³ç´°è§£æ±ºæ–¹æ¡ˆ
- **[KPIåœ–è¡¨åŠŸèƒ½ä½¿ç”¨æŒ‡å—.md](./KPIåœ–è¡¨åŠŸèƒ½ä½¿ç”¨æŒ‡å—.md)** - åœ–è¡¨åŠŸèƒ½å®Œæ•´èªªæ˜
- **[CMSæ›´æ–°å•é¡Œè¨ºæ–·èˆ‡è§£æ±ºæ–¹æ¡ˆ.md](./CMSæ›´æ–°å•é¡Œè¨ºæ–·èˆ‡è§£æ±ºæ–¹æ¡ˆ.md)** - ç·©å­˜å•é¡ŒæŠ€è¡“è¨ºæ–·

---

## ğŸ§ª æ¸¬è©¦å·¥å…·

### æ¸¬è©¦è…³æœ¬

```bash
./test-cms-updates.sh
```

### æ‰‹å‹•æ¸¬è©¦

```bash
# æ¸¬è©¦ CMS API
curl http://34.81.244.21:1337/homepage-setting
curl http://34.81.244.21:1337/kpi-configs

# æ¸¬è©¦ Backend API
curl http://34.81.244.21:8000/api/cms/homepage-settings
curl http://34.81.244.21:8000/api/cms/kpi-configs

# æ¸¬è©¦å‰å°
curl http://34.81.244.21:3000 | grep '<h1'
```

---

## ğŸ“‹ æª”æ¡ˆæ¸…å–®

### æ–°å¢æª”æ¡ˆ

- `frontend/app/components/KpiCharts.tsx` - KPI åœ–è¡¨çµ„ä»¶ï¼ˆ~500 è¡Œï¼‰
- `deploy-kpi-charts.sh` - ä¸€éµéƒ¨ç½²è…³æœ¬
- `test-cms-updates.sh` - æ¸¬è©¦è…³æœ¬
- `å®Œæ•´è§£æ±ºæ–¹æ¡ˆç¸½çµ.md` - ç¸½çµæ–‡ä»¶
- `KPIåœ–è¡¨åŠŸèƒ½ä½¿ç”¨æŒ‡å—.md` - ä½¿ç”¨æŒ‡å—
- `CMSæ›´æ–°å•é¡Œè¨ºæ–·èˆ‡è§£æ±ºæ–¹æ¡ˆ.md` - æŠ€è¡“è¨ºæ–·
- `KPIåœ–è¡¨åŠŸèƒ½_README.md` - æœ¬æ–‡ä»¶

### ä¿®æ”¹æª”æ¡ˆ

- `cms/api/kpi-config/models/kpi-config.settings.json` - æ–°å¢ `display_type` æ¬„ä½
- `frontend/app/page.tsx` - å¼•ç”¨æ–°çš„ KpiCharts çµ„ä»¶

---

## ğŸ’¡ æŠ€è¡“ç‰¹é»

âœ… **é›¶ä¾è³´**
- ç´” CSS å’Œ SVG å¯¦ä½œ
- ä¸å¢åŠ æ‰“åŒ…å¤§å°
- ä¸éœ€è¦å®‰è£æ–°å¥—ä»¶

âœ… **è¼•é‡é«˜æ•ˆ**
- è¼‰å…¥é€Ÿåº¦å¿«
- æ•ˆèƒ½å„ªç•°
- å‹•ç•«æµæš¢

âœ… **å®Œå…¨å¯æ§**
- å¾Œå°å®Œå…¨æ§åˆ¶
- ç„¡éœ€ä¿®æ”¹ç¨‹å¼ç¢¼
- éˆæ´»é…ç½®

âœ… **éŸ¿æ‡‰å¼è¨­è¨ˆ**
- è‡ªå‹•é©é…ä¸åŒè¢å¹•
- æ¡Œé¢/å¹³æ¿/æ‰‹æ©Ÿéƒ½å®Œç¾é¡¯ç¤º

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### ç«‹å³åŸ·è¡Œ

1. âœ… åŸ·è¡Œ `./deploy-kpi-charts.sh`
2. âœ… åœ¨ CMS ä¸­å»ºç«‹ KPI é…ç½®
3. âœ… é©—è­‰å‰å°é¡¯ç¤º

### çŸ­æœŸå„ªåŒ–ï¼ˆå¯é¸ï¼‰

1. è¨­å®š Webhook è‡ªå‹•æ¸…é™¤ç·©å­˜
2. èª¿æ•´ç·©å­˜æ™‚é–“ï¼ˆé–‹ç™¼ç’°å¢ƒï¼‰
3. å»ºç«‹æ›´å¤š KPI æŒ‡æ¨™

### é•·æœŸè¦åŠƒï¼ˆé€²éšï¼‰

1. è©•ä¼°æ˜¯å¦éœ€è¦æ›´è¤‡é›œçš„åœ–è¡¨
2. è€ƒæ…®å¼•å…¥å°ˆæ¥­åœ–è¡¨åº«ï¼ˆRecharts/Chart.jsï¼‰
3. å»ºç«‹å®Œæ•´çš„æ•¸æ“šè¦–è¦ºåŒ–ç³»çµ±

---

## ğŸ“ æ”¯æ´

å¦‚æœ‰ä»»ä½•å•é¡Œï¼š

1. æŸ¥çœ‹ç–‘é›£æ’è§£ç« ç¯€
2. é–±è®€å®Œæ•´æ–‡ä»¶
3. åŸ·è¡Œæ¸¬è©¦è…³æœ¬è¨ºæ–·

**å¤§éƒ¨åˆ†å•é¡Œéƒ½å¯ä»¥é€éé‡å•Ÿæœå‹™å’Œæ¸…é™¤ç·©å­˜è§£æ±ºï¼**

---

**ç‰ˆæœ¬ï¼š1.0**  
**æ›´æ–°æ—¥æœŸï¼š2025-11-05**

